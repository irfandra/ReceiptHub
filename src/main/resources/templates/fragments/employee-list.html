<div th:fragment="employeeListFragment">
  <div class="mx-auto max-w-7xl">
    <!-- Header -->
    <div class="mb-6">
      <h1 class="text-3xl font-bold text-white">Employee Management</h1>
      <p class="text-gray-400 mt-1">Manage employee accounts and access</p>
    </div>

    <!-- Search Bar and Add Button -->
    <div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-4 md:p-6 mb-4">
      <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
        <form method="get" action="/dashboard" class="flex-1 w-full sm:max-w-md">
          <input type="hidden" name="tab" value="employees" />
          <div class="flex gap-2">
            <input
              type="text"
              name="search"
              th:value="${search}"
              placeholder="Search by name or email..."
              class="flex-1 bg-white/5 border border-white/10 text-white text-sm rounded-lg focus:ring-[#00D2BE] focus:border-[#00D2BE] block p-2.5 backdrop-blur-sm"
            />
            <button
              type="submit"
              class="px-4 py-2.5 bg-[#00D2BE] hover:bg-[#00BBA9] text-white rounded-lg transition-colors"
            >
              Search
            </button>
            <a
              th:if="${search != null and search != ''}"
              href="/dashboard?tab=employees"
              class="px-4 py-2.5 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors"
            >
              Clear
            </a>
          </div>
        </form>
        <button
          onclick="openAddEmployeeModal()"
          class="px-4 py-2.5 bg-[#00D2BE] hover:bg-[#00BBA9] text-white rounded-lg transition-colors flex items-center gap-2 whitespace-nowrap"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"></path>
          </svg>
          Add Employee
        </button>
      </div>
    </div>

    <!-- Filter Bar -->
    <div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-4 md:p-6 mb-4">
      <form method="get" action="/dashboard">
        <input type="hidden" name="tab" value="employees" />
        <input type="hidden" name="search" th:value="${search}" />
        <div class="flex items-center gap-4">
          <label for="entriesPerPage" class="text-sm font-medium text-white whitespace-nowrap">Show entries:</label>
          <select
            id="entriesPerPage"
            name="size"
            class="bg-white/5 border border-white/10 text-white text-sm rounded-lg focus:ring-[#00D2BE] focus:border-[#00D2BE] block p-2.5 backdrop-blur-sm"
            onchange="this.form.submit()"
          >
            <option value="10" th:selected="${pageSize == 10}">10</option>
            <option value="25" th:selected="${pageSize == 25}">25</option>
            <option value="50" th:selected="${pageSize == 50}">50</option>
            <option value="100" th:selected="${pageSize == 100}">100</option>
          </select>
        </div>
      </form>
    </div>

    <!-- Employees List -->
    <div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl overflow-hidden">
      <div class="px-6 py-4 border-b border-white/10">
        <h2 class="text-xl font-semibold text-white">Employees</h2>
      </div>

      <!-- Empty State -->
      <div
        th:if="${#lists.isEmpty(employees)}"
        class="text-center py-12 px-6"
      >
        <svg
          class="mx-auto h-12 w-12 text-gray-500"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"
          />
        </svg>
        <h3 class="mt-2 text-sm font-semibold text-white">No employees found</h3>
        <p class="mt-1 text-sm text-gray-400">
          Get started by adding a new employee.
        </p>
      </div>

      <!-- DataTable -->
      <div class="overflow-x-auto p-6" th:unless="${#lists.isEmpty(employees)}">
        <table class="w-full text-sm text-left">
          <thead class="text-xs text-gray-400 uppercase border-b border-white/10">
            <tr>
              <th scope="col" class="px-6 py-4 font-semibold">ID</th>
              <th scope="col" class="px-6 py-4 font-semibold">Name</th>
              <th scope="col" class="px-6 py-4 font-semibold">Email</th>
              <th scope="col" class="px-6 py-4 font-semibold">Phone Number</th>
              <th scope="col" class="px-6 py-4 font-semibold">Role</th>
              <th scope="col" class="px-6 py-4 font-semibold">Telegram</th>
              <th scope="col" class="px-6 py-4 font-semibold">Created At</th>
              <th scope="col" class="px-6 py-4 font-semibold text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="employee : ${employees}" class="border-b border-white/10 hover:bg-white/5 transition-colors">
              <td class="px-6 py-4 font-medium text-white" th:text="${employee.id}">1</td>
              <td class="px-6 py-4 text-white" th:text="${employee.name}">Employee Name</td>
              <td class="px-6 py-4 text-gray-300" th:text="${employee.email}">email@example.com</td>
              <td class="px-6 py-4 text-gray-300" th:text="${employee.phoneNumber ?: '-'}">+1234567890</td>
              <td class="px-6 py-4">
                <span
                  th:class="${'inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ' + 
                              (employee.role == 'ADMIN' ? 'bg-purple-500/20 text-purple-300 border border-purple-500/30' : 
                               'bg-blue-500/20 text-blue-300 border border-blue-500/30')}"
                  th:text="${employee.role}"
                >
                  ROLE
                </span>
              </td>
              <td class="px-6 py-4">
                <span
                  th:if="${employee.telegramChatId != null}"
                  class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-green-500/20 text-green-300 border border-green-500/30"
                >
                  Linked
                </span>
                <span
                  th:unless="${employee.telegramChatId != null}"
                  class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-gray-500/20 text-gray-300 border border-gray-500/30"
                >
                  Not Linked
                </span>
              </td>
              <td class="px-6 py-4 text-gray-300" th:text="${#temporals.format(employee.createdAt, 'MMM dd, yyyy')}">Date</td>
              <td class="px-6 py-4">
                <div class="flex items-center justify-center gap-2">
                  <!-- Edit Button -->
                  <button
                    type="button"
                    th:attr="data-id=${employee.id}, 
                             data-name=${employee.name}, 
                             data-email=${employee.email},
                             data-phone=${employee.phoneNumber},
                             data-role=${employee.role}"
                    onclick="openEditEmployeeModal(this)"
                    class="text-blue-400 hover:text-blue-300 transition-colors p-1.5 hover:bg-blue-500/10 rounded-lg"
                    title="Edit"
                  >
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                      <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"></path>
                    </svg>
                  </button>
                  <!-- Delete Button -->
                  <button
                    type="button"
                    th:attr="data-id=${employee.id}, data-name=${employee.name}"
                    onclick="openDeleteEmployeeModal(this.getAttribute('data-id'), this.getAttribute('data-name'))"
                    class="text-red-400 hover:text-red-300 transition-colors p-1.5 hover:bg-red-500/10 rounded-lg"
                    title="Delete"
                  >
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div
        th:if="${totalPages > 1}"
        class="px-6 py-4 border-t border-white/10 flex items-center justify-between"
      >
        <span class="text-sm text-gray-400">
          Showing page <span class="font-medium text-white" th:text="${currentPage + 1}">1</span> of 
          <span class="font-medium text-white" th:text="${totalPages}">1</span>
        </span>
        <div class="flex gap-2">
          <a
            th:if="${currentPage > 0}"
            th:href="@{/dashboard(tab='employees', page=${currentPage - 1}, size=${pageSize}, search=${search})}"
            class="px-3 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors text-sm"
          >
            Previous
          </a>
          <a
            th:if="${currentPage < totalPages - 1}"
            th:href="@{/dashboard(tab='employees', page=${currentPage + 1}, size=${pageSize}, search=${search})}"
            class="px-3 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors text-sm"
          >
            Next
          </a>
        </div>
      </div>
    </div>

    <!-- Add Employee Modal -->
    <div id="addEmployeeModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 backdrop-blur-sm">
      <div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-6 m-4 max-w-md w-full">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-xl font-semibold text-white">Add New Employee</h3>
          <button onclick="closeAddEmployeeModal()" class="text-gray-400 hover:text-white">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </button>
        </div>
  <form id="addEmployeeForm" method="post" th:action="@{/dashboard/employees/add}" autocomplete="off">
          <div class="space-y-4">
            <div>
              <label for="addName" class="block text-sm font-medium text-gray-300 mb-1">Name</label>
              <input
                type="text"
                id="addName"
                name="name"
                required
                class="w-full bg-white/5 border border-white/10 text-white text-sm rounded-lg focus:ring-[#00D2BE] focus:border-[#00D2BE] block p-2.5"
              />
            </div>
            <div>
              <label for="addEmail" class="block text-sm font-medium text-gray-300 mb-1">Email</label>
              <input
                type="email"
                id="addEmail"
                name="email"
                required
                class="w-full bg-white/5 border border-white/10 text-white text-sm rounded-lg focus:ring-[#00D2BE] focus:border-[#00D2BE] block p-2.5"
              />
            </div>
            <div>
              <label for="addPhone" class="block text-sm font-medium text-gray-300 mb-1">Phone Number</label>
              <input
                type="tel"
                id="addPhone"
                name="phoneNumber"
                placeholder="+1234567890"
                class="w-full bg-white/5 border border-white/10 text-white text-sm rounded-lg focus:ring-[#00D2BE] focus:border-[#00D2BE] block p-2.5"
              />
              <p class="text-xs text-gray-400 mt-1">Include country code (e.g., +65 for Singapore, +1 for US)</p>
            </div>
            <div>
              <label for="addRole" class="block text-sm font-medium text-gray-300 mb-1">Role</label>
              <select
                id="addRole"
                name="role"
                required
                class="w-full bg-white/5 border border-white/10 text-white text-sm rounded-lg focus:ring-[#00D2BE] focus:border-[#00D2BE] block p-2.5"
              >
                <option value="EMPLOYEE">Employee</option>
                <option value="ADMIN">Admin</option>
              </select>
            </div>
          </div>
          <div class="mt-6 flex gap-3">
            <button
              type="submit"
              class="flex-1 px-4 py-2.5 bg-[#00D2BE] hover:bg-[#00BBA9] text-white rounded-lg transition-colors"
            >
              Add Employee
            </button>
            <button
              type="button"
              onclick="closeAddEmployeeModal()"
              class="flex-1 px-4 py-2.5 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors"
            >
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Edit Employee Modal -->
    <div id="editEmployeeModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 backdrop-blur-sm">
      <div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-6 m-4 max-w-md w-full">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-xl font-semibold text-white">Edit Employee</h3>
          <button onclick="closeEditEmployeeModal()" class="text-gray-400 hover:text-white">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </button>
        </div>
  <form id="editEmployeeForm" method="post" th:action="@{/dashboard/employees/edit}" autocomplete="off">
          <input type="hidden" id="editEmployeeId" name="id" />
          <div class="space-y-4">
            <div>
              <label for="editName" class="block text-sm font-medium text-gray-300 mb-1">Name</label>
              <input
                type="text"
                id="editName"
                name="name"
                required
                class="w-full bg-white/5 border border-white/10 text-white text-sm rounded-lg focus:ring-[#00D2BE] focus:border-[#00D2BE] block p-2.5"
              />
            </div>
            <div>
              <label for="editEmail" class="block text-sm font-medium text-gray-300 mb-1">Email</label>
              <input
                type="email"
                id="editEmail"
                name="email"
                required
                class="w-full bg-white/5 border border-white/10 text-white text-sm rounded-lg focus:ring-[#00D2BE] focus:border-[#00D2BE] block p-2.5"
              />
            </div>
            <div>
              <label for="editPhone" class="block text-sm font-medium text-gray-300 mb-1">Phone Number</label>
              <input
                type="tel"
                id="editPhone"
                name="phoneNumber"
                placeholder="+1234567890"
                class="w-full bg-white/5 border border-white/10 text-white text-sm rounded-lg focus:ring-[#00D2BE] focus:border-[#00D2BE] block p-2.5"
              />
              <p class="text-xs text-gray-400 mt-1">Include country code (e.g., +65 for Singapore, +1 for US)</p>
            </div>
            <div>
              <label for="editRole" class="block text-sm font-medium text-gray-300 mb-1">Role</label>
              <select
                id="editRole"
                name="role"
                required
                class="w-full bg-white/5 border border-white/10 text-white text-sm rounded-lg focus:ring-[#00D2BE] focus:border-[#00D2BE] block p-2.5"
              >
                <option value="EMPLOYEE">Employee</option>
                <option value="ADMIN">Admin</option>
              </select>
            </div>
          </div>
          <div class="mt-6 flex gap-3">
            <button
              type="submit"
              class="flex-1 px-4 py-2.5 bg-[#00D2BE] hover:bg-[#00BBA9] text-white rounded-lg transition-colors"
            >
              Save Changes
            </button>
            <button
              type="button"
              onclick="closeEditEmployeeModal()"
              class="flex-1 px-4 py-2.5 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors"
            >
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteEmployeeModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 backdrop-blur-sm">
      <div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-6 m-4 max-w-md w-full">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-xl font-semibold text-white">Confirm Delete</h3>
          <button onclick="closeDeleteEmployeeModal()" class="text-gray-400 hover:text-white">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </button>
        </div>
        <p class="text-gray-300 mb-6">
          Are you sure you want to delete <strong id="deleteEmployeeName" class="text-white"></strong>? This action cannot be undone.
        </p>
  <form id="deleteEmployeeForm" method="post" th:action="@{/dashboard/employees/delete}" autocomplete="off">
          <input type="hidden" id="deleteEmployeeId" name="id" />
          <div class="flex gap-3">
            <button
              type="submit"
              class="flex-1 px-4 py-2.5 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors"
            >
              Delete
            </button>
            <button
              type="button"
              onclick="closeDeleteEmployeeModal()"
              class="flex-1 px-4 py-2.5 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors"
            >
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Only keep modal open/close JS, remove fetch/async logic -->
    <script>
      function openAddEmployeeModal() {
        document.getElementById('addEmployeeModal').classList.remove('hidden');
        document.getElementById('addEmployeeModal').classList.add('flex');
      }
      function closeAddEmployeeModal() {
        document.getElementById('addEmployeeModal').classList.add('hidden');
        document.getElementById('addEmployeeModal').classList.remove('flex');
        document.getElementById('addEmployeeForm').reset();
      }
      function openEditEmployeeModal(button) {
        const id = button.getAttribute('data-id');
        const name = button.getAttribute('data-name');
        const email = button.getAttribute('data-email');
        const phone = button.getAttribute('data-phone');
        const role = button.getAttribute('data-role');
        document.getElementById('editEmployeeId').value = id;
        document.getElementById('editName').value = name;
        document.getElementById('editEmail').value = email;
        document.getElementById('editPhone').value = phone || '';
        document.getElementById('editRole').value = role;
        document.getElementById('editEmployeeModal').classList.remove('hidden');
        document.getElementById('editEmployeeModal').classList.add('flex');
      }
      function closeEditEmployeeModal() {
        document.getElementById('editEmployeeModal').classList.add('hidden');
        document.getElementById('editEmployeeModal').classList.remove('flex');
        document.getElementById('editEmployeeForm').reset();
      }
      function openDeleteEmployeeModal(id, name) {
        document.getElementById('deleteEmployeeId').value = id;
        document.getElementById('deleteEmployeeName').textContent = name;
        document.getElementById('deleteEmployeeModal').classList.remove('hidden');
        document.getElementById('deleteEmployeeModal').classList.add('flex');
      }
      function closeDeleteEmployeeModal() {
        document.getElementById('deleteEmployeeModal').classList.add('hidden');
        document.getElementById('deleteEmployeeModal').classList.remove('flex');
        document.getElementById('deleteEmployeeForm').reset();
      }
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closeAddEmployeeModal();
          closeEditEmployeeModal();
          closeDeleteEmployeeModal();
        }
      });
    </script>
  </div>
</div>
